{% extends extend%}

{% load jalali_tags %}
{% load static %}
{% block style %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.css">
<!-- <link rel="stylesheet" href="{% static 'admin/jquery.ui.datepicker.jalali/themes/base/jquery-ui.min.css' %}"> -->

{%endblock style%}

{% block content %}
{{get_jalali_date}}
<script type="text/javascript">
  function show_hide_row(row)
  {
   $("#"+row).slideToggle();
  }
  </script>

</script>


<div class="container py-6">
    <div class="row justify-content-md-center">
        <div class="card bg-gradient-light-green card-frame col-12">
          <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
            <div class="row">
              <div class="bg-gradient-{{ color }} shadow-{{ color }} text-center border-radius-lg pt-4 pb-3">
                <h4 class="text-white text-capitalize ps-3">چک لیست های ممیزی داخلی </h4>
              </div>
            </div>
           
          </div>
            <div class="card-body">
                
             
                <div class="row justify-content-center">
                  <div class="col-3  ">
                    <li class="list-group-item bg-transparent  border-0 d-flex justify-content-between ps-0 mb-2 ">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold">نوبت ممیزی : <span class="narowFont"> {{calenderSelected.typeMomayezi}} </span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                  <div class="col-3  ">
                    <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 ">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold"> تیم ممیزی : <span class="narowFont">{{calenderSelected.teamMomayezi}}</span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                  <div class="col-3  ">
                    <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 ">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold">تاریخ ممیزی : <span class="narowFont"> {{calenderSelected.dateMomayezi|to_jalali:'%Y/%m/%d '}} </span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                  <div class="col-3  ">
                    <li class="list-group-item bg-transparent  border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold">ساعت ممیزی : <span class="narowFont">{{calenderSelected.timeStart}}</span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                </div>
                <hr class="dark horizontal my-2"><hr class="dark horizontal my-2">
                <div class="row justify-content-center">
                  <div class="col-4  ">
                    <li class="list-group-item  bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold"> واحد تحت ممیزی : <span class="narowFont">{{calenderSelected.vahedMomayezi.title}} - {{calenderSelected.vahedMomayezi.vahedCode}}</span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>

                  <div class="col-4  ">
                    <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold">   سرپرست تیم ممیزی : <span class="narowFont">{{calenderSelected.teamMomayezi.sarMomayez.firstName}} - {{calenderSelected.teamMomayezi.sarMomayez.lastName}}</span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                 
                  <div class="col-4  ">
                    <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                      <div class="d-flex    flex-column">
                        <h5 class="mb-1 text-dark font-weight-bold">سیستم تحت ممیزی : <span class="narowFont">{{calenderSelected.systemMomayezi}}</span></h5>
                      </div>
                      <div class="d-flex align-items-center ">
                        
                      </div>
                    </li>
                  </div>
                </div>

               
               
                
                
            

            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card my-4">
                <div class="card-header p-0 position-relative mt-4 mx-3 z-index-2">
                    <div class="bg-gradient-danger shadow-info border-radius-lg px-3 pt-4 pb-3">
                        <h6 class="text-white text-center ps-3">لیست چک لیست </h6>
                    </div>
                </div>
                <div class="card-body px-0 pb-2">
                    
                 
          
          <div class="container-fluid fulled">
            <div class="row border-bottom py-3">
              <div class="col-3 text-center">عنوان پرسش </div>
              <div class="col-2 text-center">سیستم مدیریتی </div>
              <div class="col-2 text-center">بند استاندارد</div>
              <div class="col-2 text-center">نتیجه</div>
              <div class="col-1 text-center">بیشتر</div>
              <div class="col-1 text-center">انجام دادن</div>
            </div>
            
            {%for  clusesCode ,clusesFull ,datas in zipCheckList%}
            
              
             
           
                
                  <div class="row border-bottom py-3">
                    
                        <div class="col-3 text-center narowFont">{{datas.title|truncatechars_html:70}}</div>
                        <div class="col-2 text-center narowFont">ISO 9001:2015</div>
                        <div class="col-2 text-center narowFont">
                          {%for cluse in clusesCode%}
                           {{cluse}} , 
                          {%endfor%}
                        </div>
                        {%if datas.result == 'ok'%}
                          <div class="col-2 text-center">قابل قبول</div>
                        {% elif datas.result == 'Obs'  %}
                       
                          <div class="col-2 text-center">0 .bs </div>
                        {% elif datas.result == 'min'  %}
                          <div class="col-2 text-center">عدم انطباق جزئی </div>
                        
                        {% elif datas.result == 'maj'  %}
                          <div class="col-2 text-center">عدم انطباق کلی </div>
                        {% else %}
                        <div class="col-2 text-center">ثبت نشده است</div>
                        {% endif %}
             
                        <a href="#" onclick="show_hide_row('hidden_row{{datas.id}}');" class="col-1 text-black-80 ">
                          <div class="  ms-2 d-flex align-items-center justify-content-center">
                            <img style="max-width: 50px;" src="{% static 'img/svg/view.svg' %}" >
                          </div>
                        </a>
                        {%  if datas.activity.status == 'doing' %}
                        <a class="text-black-80 col-1" href="{% url 'UpdateViewCheckListMomayezi' datas.id %}"   >
                          <div class="  ms-2 d-flex align-items-center justify-content-center">
                            <img style="max-width: 50px;" src="{% static 'img/svg/edit.svg' %}" >
                          </div>
                        </a>
                        {% endif %}
                   
                        
                  </div>
                  <div id="hidden_row{{datas.id}}" class="hidden_row row moreData py-3" style="display:none">

                    <div class="row justify-content-center">
                      <div class="col-3  ">
                        <li class="list-group-item bg-transparent  border-0 d-flex justify-content-between ps-0 mb-2 ">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold">نوبت ممیزی : <span class="narowFont"> {{calenderSelected.typeMomayezi}} </span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                      <div class="col-3  ">
                        <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 ">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold"> تیم ممیزی : <span class="narowFont">{{calenderSelected.teamMomayezi}}</span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                      <div class="col-3  ">
                        <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 ">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold">تاریخ ممیزی : <span class="narowFont"> {{calenderSelected.dateMomayezi|to_jalali:'%Y/%m/%d '}} </span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                      <div class="col-3  ">
                        <li class="list-group-item bg-transparent  border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold">ساعت ممیزی : <span class="narowFont">{{calenderSelected.timeStart}}</span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                    </div>
                    <hr class="dark horizontal my-2"><hr class="dark horizontal my-2">
                    <div class="row justify-content-center">
                      <div class="col-4  ">
                        <li class="list-group-item  bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold"> واحد تحت ممیزی : <span class="narowFont">{{calenderSelected.vahedMomayezi.title}} - {{calenderSelected.vahedMomayezi.vahedCode}}</span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
    
                      <div class="col-4  ">
                        <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold">   سرپرست تیم ممیزی : <span class="narowFont">{{calenderSelected.teamMomayezi.sarMomayez.firstName}} - {{calenderSelected.teamMomayezi.sarMomayez.lastName}}</span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                     
                      <div class="col-4  ">
                        <li class="list-group-item bg-transparent border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                          <div class="d-flex    flex-column">
                            <h5 class="mb-1 text-dark font-weight-bold">سیستم تحت ممیزی : <span class="narowFont">{{calenderSelected.systemMomayezi}}</span></h5>
                          </div>
                          <div class="d-flex align-items-center ">
                            
                          </div>
                        </li>
                      </div>
                    </div>
    
                    
                   

                    <hr class="dark horizontal my-2">
                    <div class="py-3">
                      <span class="fw-bold text-dark" >   موضوع : </span>
                      <p class="py-3 text-2xl narowFont">{{datas.title}}</p>
                    </div>
                    <hr class="dark horizontal">
                    
                    <div class="py-3">
                      <span class="fw-bold text-dark" >   بند استاندارد   : </span>
                      {%for cluse in clusesFull%}
                      <span class=" narowFont d-block mx-3" >{{cluse}}</span>
                      {%endfor%}
                     
                    </div>
                    <hr class="dark horizontal">
                    
                    <div class="py-3">
                      <span class="fw-bold text-dark" >  مشاهدات    : </span>
                      <p class="py-3 text-2xl narowFont ">
                        {%if datas.observed == "None"%}
                          ثبت نشده است
                        {%else%}
                        {{datas.observed}}
                        {%endif%}
                      </p>
                    </div>

                    <hr class="dark horizontal">
                    
                    <div class="py-3">
                      <span class="fw-bold text-dark" >  نتیجه    : </span>

                      {%if datas.result == 'ok'%}
                          <p class="py-3 text-2xl narowFont ">قابل قبول</p>
                        {% elif datas.result == 'Obs'  %}
                       
                          <p class="py-3 text-2xl narowFont ">Obs </p>
                        {% elif datas.result == 'min'  %}
                          <p class="py-3 text-2xl narowFont ">عدم انطباق جزئی </p>
                        
                        {% elif datas.result == 'maj'  %}
                          <p class="py-3 text-2xl narowFont ">عدم انطباق کلی </p>
                        {% else %}
                        <p class="py-3 text-2xl narowFont ">ثبت نشده است</p>
                        {% endif %}
                      
                    </div>
                    
                  </div>
                  {% endfor %}
         


                  <div class="row justify-content-md-center">
           
                    <div class="col-5">
                      <a href="{%url menuBack%}" class="btn w-100  btn-outline-danger">
                        بازگشت </a>
                    </div>
                  </div>


        
                  
                    
                </div>
            </div>
        </div>
      </div>
</div>

  <div id="results"></div>


{% endblock content %}


{% block scripts %}
<script
src="https://code.jquery.com/jquery-3.6.0.min.js"
integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="{% static '/js/dataTables.js' %}"></script>


		<!-- <script src="{% static 'admin/js/django_jalali.min.js' %}"></script> -->
	<!-- OR -->
	<!-- loading by form (if used AdminJalaliDateWidget) -->
		{{ form.media }}

<script>
  // json_load_process
  const groupDataBox =document.getElementById('id_group') 
  const groupBox = document.getElementById('id_group')

  const processDataBox =document.getElementById('id_process') 
  const processBox = document.getElementById('id_process')

  $.ajax({
    type:'GET',
    url: '/risk/identification/json/load-prcoess/',
    success:function(response){
      console.log(response.data)
      const processData = response.data
      processData.map(item=>{
        const option = document.createElement('div')
        option.textContent = item.name
        option.setAttribute('class','item')
        option.setAttribute('data-value',item.name)
        groupDataBox.appendChild(option)
      }

      )
    },
    error: function(error){
      console.log(error)
    },
  })

  groupBox.addEventListener('change' , e=>{
    console.log(e.target.value)
    const selectedGroup = e.target.value
    processBox.innerHTML = ''
    processBox.textContent = "---------"
    $.ajax({
      type:'GET',
      url: '/risk/identification/json/get_json_group_data/' + e.target.value,
      
      success: function(response){
        console.log(response.data)
        const processData = response.data
        
        processData.map(item=>{
          const option = document.createElement('option')
          option.textContent = item.title
          option.value = item.id
      
          processDataBox.appendChild(option)
        })
      },
      error: function(error){
        console.log(error)
      }
    })

  })

 
</script>

{%endblock scripts%}





